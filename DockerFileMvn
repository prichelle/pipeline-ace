# Copyright (c) 2020 Open Technologies for Integration
# Licensed under the MIT license (see LICENSE for details)

# ACE Maven Build Image
# This image contains Maven tooling for building and testing ACE Java-based unit tests

ARG BASE_IMAGE=ibmcom/ace-server:latest
FROM $BASE_IMAGE

LABEL maintainer="prichelle@be.ibm.com" \
      description="ACE server with Maven for unit testing" \
      version="1.0"

USER root

# For dev pipeline use we can accept the ACE license automatically
ENV LICENSE=accept

# Install Maven directly to avoid unnecessary dependencies
# Using newer Maven version (3.9.6) for better performance and security
ENV MAVEN_VERSION=3.9.6
ENV MAVEN_HOME=/opt/apache-maven-${MAVEN_VERSION}

RUN cd /opt && \
    # Use --fail to error on HTTP errors, remove -k for security
    curl -fsSL https://archive.apache.org/dist/maven/maven-3/${MAVEN_VERSION}/binaries/apache-maven-${MAVEN_VERSION}-bin.tar.gz \
        -o maven.tar.gz && \
    tar -xzf maven.tar.gz && \
    rm maven.tar.gz && \
    ln -s ${MAVEN_HOME}/bin/mvn /usr/local/bin/mvn && \
    # Verify Maven installation
    mvn --version

# Set timezone
ENV TZ=Europe/Brussels

# Set working directory
WORKDIR /workspace

# Default command to run
ENTRYPOINT []
CMD ["/bin/bash"]